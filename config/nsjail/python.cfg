name: "python-sandbox"
description: "Python 3 execution sandbox"

mode: ONCE
hostname: "sandbox"
cwd: "/workspace"

time_limit: 30
rlimit_as: 268435456
rlimit_cpu: 30
rlimit_fsize: 10485760
rlimit_nofile: 64
rlimit_nproc: 32

clone_newnet: true
clone_newuser: true
clone_newns: true
clone_newpid: true
clone_newipc: true
clone_newuts: true

mount {
    src: "/usr"
    dst: "/usr"
    is_bind: true
    rw: false
}

mount {
    src: "/lib"
    dst: "/lib"
    is_bind: true
    rw: false
}

mount {
    src: "/lib64"
    dst: "/lib64"
    is_bind: true
    rw: false
    mandatory: false
}

mount {
    dst: "/tmp"
    fstype: "tmpfs"
    rw: true
    options: "size=16777216"
}

mount {
    dst: "/dev"
    fstype: "tmpfs"
    rw: false
}

mount {
    src: "/dev/null"
    dst: "/dev/null"
    is_bind: true
    rw: true
}

mount {
    src: "/dev/urandom"
    dst: "/dev/urandom"
    is_bind: true
    rw: false
}

mount {
    src: "{{WORKSPACE}}"
    dst: "/workspace"
    is_bind: true
    rw: true
}

mount {
    dst: "/proc"
    fstype: "proc"
    rw: false
}

seccomp_string: "ALLOW { read, write, open, openat, close, fstat, lseek, mmap, mprotect, munmap, brk, rt_sigaction, rt_sigprocmask, rt_sigreturn, ioctl, access, faccessat, pipe, pipe2, select, pselect6, sched_yield, mremap, msync, mincore, madvise, dup, dup2, dup3, nanosleep, clock_nanosleep, getitimer, alarm, setitimer, getpid, sendfile, socket, connect, accept, accept4, sendto, recvfrom, sendmsg, recvmsg, shutdown, bind, listen, getsockname, getpeername, socketpair, setsockopt, getsockopt, clone, clone3, fork, vfork, execve, execveat, exit, exit_group, wait4, waitid, kill, uname, fcntl, flock, fsync, fdatasync, truncate, ftruncate, getdents, getdents64, getcwd, chdir, fchdir, rename, renameat, renameat2, mkdir, mkdirat, rmdir, creat, link, linkat, unlink, unlinkat, symlink, symlinkat, readlink, readlinkat, chmod, fchmod, fchmodat, chown, fchown, fchownat, lchown, umask, gettimeofday, getrlimit, getrusage, sysinfo, times, ptrace, getuid, syslog, getgid, setuid, setgid, geteuid, getegid, setpgid, getppid, getpgrp, setsid, setreuid, setregid, getgroups, setgroups, setresuid, getresuid, setresgid, getresgid, getpgid, setfsuid, setfsgid, getsid, capget, capset, rt_sigpending, rt_sigtimedwait, rt_sigqueueinfo, rt_sigsuspend, sigaltstack, utime, utimes, futimesat, utimensat, newfstatat, lstat, statfs, fstatfs, sysfs, getpriority, setpriority, sched_setparam, sched_getparam, sched_setscheduler, sched_getscheduler, sched_get_priority_max, sched_get_priority_min, sched_rr_get_interval, mlock, munlock, mlockall, munlockall, vhangup, pivot_root, prctl, arch_prctl, adjtimex, setrlimit, chroot, sync, acct, settimeofday, mount, swapon, swapoff, reboot, sethostname, setdomainname, ioperm, iopl, create_module, init_module, delete_module, get_kernel_syms, query_module, quotactl, nfsservctl, getpmsg, putpmsg, afs_syscall, tuxcall, security, gettid, readahead, setxattr, lsetxattr, fsetxattr, getxattr, lgetxattr, fgetxattr, listxattr, llistxattr, flistxattr, removexattr, lremovexattr, fremovexattr, tkill, futex, sched_setaffinity, sched_getaffinity, set_thread_area, get_thread_area, io_setup, io_destroy, io_getevents, io_submit, io_cancel, lookup_dcookie, epoll_create, epoll_create1, epoll_ctl, epoll_wait, epoll_pwait, epoll_pwait2, remap_file_pages, getdents64, set_tid_address, restart_syscall, semtimedop, fadvise64, timer_create, timer_settime, timer_gettime, timer_getoverrun, timer_delete, clock_settime, clock_gettime, clock_getres, clock_nanosleep, exit_group, epoll_wait, epoll_ctl, tgkill, utimes, mbind, set_mempolicy, get_mempolicy, mq_open, mq_unlink, mq_timedsend, mq_timedreceive, mq_notify, mq_getsetattr, kexec_load, waitid, add_key, request_key, keyctl, ioprio_set, ioprio_get, inotify_init, inotify_init1, inotify_add_watch, inotify_rm_watch, migrate_pages, openat, mkdirat, mknodat, fchownat, futimesat, newfstatat, unlinkat, renameat, linkat, symlinkat, readlinkat, fchmodat, faccessat, ppoll, unshare, set_robust_list, get_robust_list, splice, tee, sync_file_range, vmsplice, move_pages, getcpu, signalfd, signalfd4, timerfd_create, eventfd, eventfd2, fallocate, timerfd_settime, timerfd_gettime, accept4, signalfd4, eventfd2, epoll_create1, dup3, pipe2, inotify_init1, preadv, pwritev, preadv2, pwritev2, rt_tgsigqueueinfo, perf_event_open, recvmmsg, fanotify_init, fanotify_mark, prlimit64, name_to_handle_at, open_by_handle_at, clock_adjtime, syncfs, sendmmsg, setns, process_vm_readv, process_vm_writev, kcmp, finit_module, sched_setattr, sched_getattr, renameat2, seccomp, getrandom, memfd_create, bpf, execveat, userfaultfd, membarrier, mlock2, copy_file_range, preadv2, pwritev2, pkey_mprotect, pkey_alloc, pkey_free, statx, rseq, pidfd_send_signal, io_uring_setup, io_uring_enter, io_uring_register, open_tree, move_mount, fsopen, fsconfig, fsmount, fspick, pidfd_open, clone3, close_range, openat2, pidfd_getfd, faccessat2, process_madvise, epoll_pwait2, mount_setattr, landlock_create_ruleset, landlock_add_rule, landlock_restrict_self, memfd_secret }"

exec_bin {
    path: "/usr/bin/python3"
    arg0: "python3"
    arg: "main.py"
}
